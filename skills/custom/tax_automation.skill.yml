name: tax_automation
title: Expert Tax Automation & Multi-Business Strategist
version: 1.0.0
description: Comprehensive tax automation and multi-business optimization system for federal and state taxes, entity structure
  analysis, and strategic tax planning
metadata:
  author: Revvel AI Engine
  category: Marketing & Business
  tags:
  - auto-filing preparation (form 1040, schedule c, schedule e, schedule se, form 8829, form 4562, form 1099 reconciliation)
  - federal and state tax calculation for all 50 states
  - historical tax year analysis for amended returns
  - credit and deduction optimization (eitc, child tax credit, saver's credit, education credits, ev credits, energy efficiency
    credits, home office, self-employment deductions)
  - quarterly estimated tax calculator (form 1040-es)
  - 1099 income tracking and reconciliation
  - tax
  - automation
  - self-employment tax optimization
  - passive vs active income classification engine
  source: revvel-custom
  created_at: '2026-02-14'
  updated_at: '2026-02-16'
dependencies:
  pip_packages: []
implementation:
  type: python_code
  language: python
  content: "import json\nimport re\nimport os\nimport math\nimport hashlib\nimport datetime\nimport unittest\nfrom typing\
    \ import Dict, List, Any, Optional, Tuple, Union\nfrom collections import defaultdict\nfrom dataclasses import dataclass,\
    \ asdict\nimport requests\n\nSKILL_METADATA = {\n    \"name\": \"Expert Tax Automation & Multi-Business Strategist\",\n\
    \    \"id\": \"tax_automation\",\n    \"version\": \"1.0.0\",\n    \"author\": \"Revvel AI Engine\",\n    \"description\"\
    : \"Comprehensive tax automation and multi-business optimization system for federal and state taxes, entity structure\
    \ analysis, and strategic tax planning\",\n    \"capabilities\": [\n        \"Federal and state tax calculation for all\
    \ 50 states\",\n        \"Credit and deduction optimization (EITC, Child Tax Credit, Saver's Credit, Education Credits,\
    \ EV credits, energy efficiency credits, home office, self-employment deductions)\",\n        \"Historical tax year analysis\
    \ for amended returns\",\n        \"Auto-filing preparation (Form 1040, Schedule C, Schedule E, Schedule SE, Form 8829,\
    \ Form 4562, Form 1099 reconciliation)\",\n        \"Quarterly estimated tax calculator (Form 1040-ES)\",\n        \"\
    Self-employment tax optimization\",\n        \"Passive vs active income classification engine\",\n        \"1099 income\
    \ tracking and reconciliation\",\n        \"W-2 analysis and withholding optimization\",\n        \"Depreciation calculator\
    \ (MACRS, Section 179, bonus depreciation)\",\n        \"Mileage/gas tracking with IRS standard rate calculation\",\n\
    \        \"Receipt scanning and categorization\",\n        \"Tax loss harvesting for investments\",\n        \"State-specific\
    \ credits and incentives\",\n        \"Green energy credits optimization\",\n        \"Business entity analysis and optimization\"\
    ,\n        \"Multi-entity tax optimization\",\n        \"Partnership agreement generation\",\n        \"Operating agreement\
    \ templates\",\n        \"EIN application automation\",\n        \"State business registration requirements\",\n     \
    \   \"Annual compliance calendar management\"\n    ],\n    \"domain\": \"tax_automation_multi_business_optimization\"\n\
    }\n\nEXPERT_PROMPTS = {\n    \"tax_optimization_analysis\": \"\"\"\nAnalyze the tax optimization opportunities for {taxpayer_name}\
    \ based on the following financial data:\nIncome Sources: {income_sources}\nBusiness Entities: {business_entities}\nCurrent\
    \ Structure: {current_structure}\nTax Year: {tax_year}\nState: {state}\nSpecial Considerations: {special_considerations}\n\
    \nProvide recommendations for:\n1. Optimal business structure (sole prop, LLC, S-Corp, C-Corp, partnership)\n2. Tax credits\
    \ and deductions available\n3. Income shifting strategies between entities\n4. Estimated tax savings by structure\n5.\
    \ Filing requirements and deadlines\n\"\"\",\n    \n    \"vine_business_optimization\": \"\"\"\nOptimize tax strategy\
    \ for Amazon Vine reviewer {taxpayer_name}:\n- Vine ETV income: ${vine_etv_amount}\n- Hours spent monthly: {monthly_hours}\n\
    - Amazon orders for reviews: ${amazon_orders_amount}\n- Products donated to rental business: {donated_products}\n- Storage\
    \ units used: {storage_units}\n\nDetermine:\n1. Passive vs active income classification\n2. Optimal business structure\
    \ for tax purposes\n3. Deduction strategies for Amazon orders\n4. Depreciation schedule for donated items\n5. Self-employment\
    \ tax implications\n\"\"\",\n    \n    \"multi_entity_tax_planning\": \"\"\"\nCreate multi-entity tax optimization plan\
    \ for:\nEntities: {entities}\nIncome allocation: {income_allocation}\nExpense categories: {expense_categories}\nState\
    \ requirements: {state_requirements}\n\nProvide:\n1. Optimal income shifting strategies\n2. Expense allocation methods\n\
    3. State tax minimization techniques\n4. Compliance requirements per entity\n5. Estimated overall tax savings\n\"\"\"\
    ,\n    \n    \"quarterly_estimated_taxes\": \"\"\"\nCalculate quarterly estimated tax payments for {taxpayer_name}:\n\
    Current year income: {current_income}\nPrior year tax liability: {prior_tax}\nBusiness income: {business_income}\nW-2\
    \ withholding: {w2_withholding}\nState: {state}\n\nProvide:\n1. Federal quarterly payments (Form 1040-ES)\n2. State quarterly\
    \ payments if applicable\n3. Safe harbor calculations\n4. Annualized income method if beneficial\n5. Payment schedule\
    \ and amounts\n\"\"\",\n    \n    \"depreciation_optimization\": \"\"\"\nOptimize depreciation strategy for business assets:\n\
    Asset details: {asset_details}\nBusiness type: {business_type}\nTax year: {tax_year}\nIncome level: {income_level}\n\n\
    Recommend:\n1. MACRS vs Section 179 vs bonus depreciation\n2. Optimal depreciation schedule\n3. Tax impact analysis\n\
    4. State conformity considerations\n5. Future year planning opportunities\n\"\"\",\n    \n    \"passive_activity_analysis\"\
    : \"\"\"\nAnalyze passive activity rules for {taxpayer_name}:\nActivities: {activities}\nHours participated: {participation_hours}\n\
    Income/loss: {income_loss}\nMaterial participation: {material_participation}\n\nDetermine:\n1. Passive vs active classification\
    \ for each activity\n2. PAL (Passive Activity Loss) limitations\n3. Grouping opportunities under Section 1.469-4\n4. Real\
    \ estate professional status eligibility\n5. Tax planning strategies\n\"\"\",\n    \n    \"state_tax_optimization\": \"\
    \"\"\nOptimize state tax strategy for {state}:\nIncome sources: {income_sources}\nBusiness activities: {business_activities}\n\
    Credits available: {available_credits}\nFiling requirements: {filing_requirements}\n\nProvide:\n1. State-specific deductions\
    \ and credits\n2. Nexus considerations\n3. Apportionment factors\n4. Filing requirements\n5. Tax minimization strategies\n\
    \"\"\",\n    \n    \"business_structure_comparison\": \"\"\"\nCompare business structures for {business_purpose}:\nCurrent\
    \ structure: {current_structure}\nAnnual revenue: {annual_revenue}\nNumber of owners: {num_owners}\nLiability concerns:\
    \ {liability_concerns}\nTax preferences: {tax_preferences}\n\nAnalyze:\n1. Sole proprietorship vs LLC vs S-Corp vs C-Corp\
    \ vs Partnership\n2. Tax implications of each structure\n3. Self-employment tax impact\n4. Liability protection analysis\n\
    5. Recommended optimal structure\n\"\"\"\n}\n\nINTEGRATION_POINTS = {\n    \"irs_forms_api\": {\n        \"type\": \"\
    api\",\n        \"endpoint\": \"https://api.irs.gov/forms\",\n        \"description\": \"IRS forms and publications API\
    \ for latest tax forms\",\n        \"auth_method\": \"api_key\",\n        \"documentation_url\": \"https://www.irs.gov/developers\"\
    \n    },\n    \"state_tax_api\": {\n        \"type\": \"api\",\n        \"endpoint\": \"https://api.taxadmin.org/state-tax\"\
    ,\n        \"description\": \"State tax rates and forms for all 50 states\",\n        \"auth_method\": \"oauth2\",\n \
    \       \"documentation_url\": \"https://www.taxadmin.org/api-docs\"\n    },\n    \"avalara_tax_engine\": {\n        \"\
    type\": \"api\",\n        \"endpoint\": \"https://rest.avatax.com/api/v2\",\n        \"description\": \"Avalara tax calculation\
    \ engine for complex scenarios\",\n        \"auth_method\": \"api_key\",\n        \"documentation_url\": \"https://developer.avalara.com/sdk/python\"\
    \n    },\n    \"taxbandits_filing\": {\n        \"type\": \"api\",\n        \"endpoint\": \"https://api.taxbandits.com/v1.7.3\"\
    ,\n        \"description\": \"TaxBandits API for form filing and status tracking\",\n        \"auth_method\": \"oauth2\"\
    ,\n        \"documentation_url\": \"https://developer.taxbandits.com/docs/apireference/gettingstarted\"\n    },\n    \"\
    tax_calculator_models\": {\n        \"type\": \"tool\",\n        \"endpoint\": \"local\",\n        \"description\": \"\
    Tax-Calculator microsimulation model for policy analysis\",\n        \"auth_method\": \"none\",\n        \"documentation_url\"\
    : \"http://taxcalc.pslmodels.org/\"\n    },\n    \"business_registry_db\": {\n        \"type\": \"database\",\n      \
    \  \"endpoint\": \"postgresql://localhost:5432/business_registry\",\n        \"description\": \"State business registration\
    \ requirements and forms\",\n        \"auth_method\": \"connection_string\",\n        \"documentation_url\": \"internal\"\
    \n    },\n    \"compliance_calendar\": {\n        \"type\": \"tool\",\n        \"endpoint\": \"local\",\n        \"description\"\
    : \"Annual compliance calendar generator\",\n        \"auth_method\": \"none\",\n        \"documentation_url\": \"internal\"\
    \n    }\n}\n\n@dataclass\nclass TaxEntity:\n    \"\"\"Represents a tax entity (individual or business)\"\"\"\n    name:\
    \ str\n    entity_type: str\n    ein: Optional[str] = None\n    state: str = \"Federal\"\n    income_sources: List[Dict]\
    \ = None\n    expenses: List[Dict] = None\n    assets: List[Dict] = None\n    \n    def __post_init__(self):\n       \
    \ if self.income_sources is None:\n            self.income_sources = []\n        if self.expenses is None:\n         \
    \   self.expenses = []\n        if self.assets is None:\n            self.assets = []\n\n@dataclass\nclass TaxCalculation:\n\
    \    \"\"\"Results of tax calculation\"\"\"\n    federal_tax: float\n    state_tax: float\n    self_employment_tax: float\n\
    \    total_tax: float\n    effective_rate: float\n    credits: List[Dict]\n    deductions: List[Dict]\n    quarterly_payments:\
    \ List[float]\n\nclass TaxAutomationEngine:\n    \"\"\"Main engine for tax automation and multi-business optimization\"\
    \"\"\n    \n    def __init__(self, config: Dict[str, Any]):\n        self.config = config\n        self.tax_year = config.get('tax_year',\
    \ datetime.datetime.now().year)\n        self.debug = config.get('debug', False)\n        self.federal_brackets = self._load_federal_brackets()\n\
    \        self.state_brackets = self._load_state_brackets()\n        \n    def _load_federal_brackets(self) -> Dict:\n\
    \        \"\"\"Load federal tax brackets for current year\"\"\"\n        return {\n            2024: {\n             \
    \   10: (0, 11600),\n                12: (11600, 47150),\n                22: (47150, 100525),\n                24: (100525,\
    \ 191950),\n                32: (191950, 243725),\n                35: (243725, 609350),\n                37: (609350,\
    \ float('inf'))\n            }\n        }.get(self.tax_year, {})\n    \n    def _load_state_brackets(self) -> Dict:\n\
    \        \"\"\"Load state tax brackets (simplified for demo)\"\"\"\n        return {\n            \"CA\": {\n        \
    \        1: (0, 10099),\n                2: (10099, 23942),\n                4: (23942, 37788),\n                6: (37788,\
    \ 52455),\n                8: (52455, 66295),\n                9.3: (66295, 338639),\n                10.3: (338639, 406364),\n\
    \                11.3: (406364, 677278),\n                12.3: (677278, float('inf'))\n            },\n            \"\
    NY\": {\n                4: (0, 8500),\n                4.5: (8500, 11700),\n                5.25: (11700, 13900),\n \
    \               5.9: (13900, 80650),\n                6.33: (80650, 215400),\n                6.57: (215400, 1077550),\n\
    \                8.82: (1077550, float('inf'))\n            }\n        }\n    \n    def calculate_federal_tax(self, taxable_income:\
    \ float, filing_status: str = \"single\") -> float:\n        \"\"\"Calculate federal income tax using progressive brackets\"\
    \"\"\n        if not self.federal_brackets:\n            return taxable_income * 0.22  # Default estimate\n          \
    \  \n        tax = 0.0\n        for rate, (low, high) in self.federal_brackets.items():\n            if taxable_income\
    \ > low:\n                bracket_income = min(taxable_income, high) - low\n                tax += bracket_income * (rate\
    \ / 100)\n            else:\n                break\n        return tax\n    \n    def calculate_state_tax(self, taxable_income:\
    \ float, state: str) -> float:\n        \"\"\"Calculate state income tax\"\"\"\n        if state not in self.state_brackets:\n\
    \            return taxable_income * 0.05  # Default estimate\n            \n        tax = 0.0\n        for rate, (low,\
    \ high) in self.state_brackets[state].items():\n            if taxable_income > low:\n                bracket_income =\
    \ min(taxable_income, high) - low\n                tax += bracket_income * (rate / 100)\n            else:\n         \
    \       break\n        return tax\n    \n    def calculate_self_employment_tax(self, net_earnings: float) -> float:\n\
    \        \"\"\"Calculate self-employment tax (Social Security and Medicare)\"\"\"\n        if net_earnings <= 0:\n   \
    \         return 0.0\n            \n        # Social Security portion (12.4% up to wage base limit)\n        ss_wage_base\
    \ = 168600 if self.tax_year >= 2024 else 147000\n        ss_tax = min(net_earnings * 0.124, ss_wage_base * 0.124)\n  \
    \      \n        # Medicare portion (2.9% unlimited, plus 0.9% surtax if applicable)\n        medicare_tax = net_earnings\
    \ * 0.029\n        if net_earnings > 200000:\n            medicare_tax += (net_earnings - 200000) * 0.009\n          \
    \  \n        return ss_tax + medicare_tax\n    \n    def optimize_business_structure(self, revenue: float, expenses: float,\
    \ num_owners: int, \n                                   liability_concerns: bool, state: str) -> Dict[str, Any]:\n   \
    \     \"\"\"Analyze and recommend optimal business structure\"\"\"\n        net_income = revenue - expenses\n        \n\
    \        structures = {\n            \"sole_proprietorship\": {\n                \"complexity\": 1,\n                \"\
    liability_protection\": False,\n                \"self_employment_tax\": net_income * 0.153 if net_income > 0 else 0,\n\
    \                \"admin_costs\": 0,\n                \"formation_cost\": 0\n            },\n            \"llc\": {\n\
    \                \"complexity\": 2,\n                \"liability_protection\": True,\n                \"self_employment_tax\"\
    : net_income * 0.153 if net_income > 0 else 0,\n                \"admin_costs\": 500,\n                \"formation_cost\"\
    : 300\n            },\n            \"s_corp\": {\n                \"complexity\": 4,\n                \"liability_protection\"\
    : True,\n                \"self_employment_tax\": self._calculate_s_corp_payroll_tax(net_income),\n                \"\
    admin_costs\": 2000,\n                \"formation_cost\": 500\n            },\n            \"c_corp\": {\n           \
    \     \"complexity\": 5,\n                \"liability_protection\": True,\n                \"self_employment_tax\": 0,\n\
    \                \"admin_costs\": 3000,\n                \"formation_cost\": 1000\n            }\n        }\n        \n\
    \        recommendations = []\n        for structure, data in structures.items():\n            score = self._score_structure(net_income,\
    \ data, liability_concerns)\n            recommendations.append({\n                \"structure\": structure,\n       \
    \         \"score\": score,\n                \"tax_savings\": data[\"self_employment_tax\"],\n                \"total_costs\"\
    : data[\"admin_costs\"] + data[\"formation_cost\"],\n                \"liability_protection\": data[\"liability_protection\"\
    ]\n            })\n        \n        return {\n            \"recommendations\": sorted(recommendations, key=lambda x:\
    \ x[\"score\"], reverse=True),\n            \"optimal_structure\": max(recommendations, key=lambda x: x[\"score\"])[\"\
    structure\"]\n        }\n    \n    def _calculate_s_corp_payroll_tax(self, net_income: float) -> float:\n        \"\"\"\
    Calculate payroll tax for S-Corp with reasonable salary\"\"\"\n        if net_income <= 0:\n            return 0.0\n \
    \           \n        # Assume reasonable salary is 40% of net income (simplified)\n        reasonable_salary = net_income\
    \ * 0.4\n        \n        # Payroll taxes on salary only\n        ss_wage_base = 168600 if self.tax_year >= 2024 else\
    \ 147000\n        ss_tax = min(reasonable_salary * 0.124, ss_wage_base * 0.124)\n        medicare_tax = reasonable_salary\
    \ * 0.029\n        \n        return ss_tax + medicare_tax\n    \n    def _score_structure(self, net_income: float, structure_data:\
    \ Dict, liability_concerns: bool) -> float:\n        \"\"\"Score business structure based on multiple factors\"\"\"\n\
    \        score = 0.0\n        \n        # Tax efficiency (40% weight)\n        tax_savings = structure_data.get(\"self_employment_tax\"\
    , 0)\n        if net_income > 50000:  # Higher income favors S-Corp\n            score += (1 if structure_data[\"complexity\"\
    ] >= 3 else 0) * 0.4\n        else:\n            score += (1 if structure_data[\"complexity\"] <= 2 else 0) * 0.4\n  \
    \          \n        # Liability protection (30% weight)\n        if liability_concerns:\n            score += (1 if structure_data[\"\
    liability_protection\"] else 0) * 0.3\n        else:\n            score += 0.15  # Neutral if no liability concerns\n\
    \            \n        # Cost effectiveness (20% weight)\n        total_costs = structure_data.get(\"admin_costs\", 0)\
    \ + structure_data.get(\"formation_cost\", 0)\n        if net_income > total_costs * 2:  # Costs should be < 50% of income\n\
    \            score += 0.2\n            \n        # Simplicity (10% weight)\n        score += (1 / structure_data.get(\"\
    complexity\", 1)) * 0.1\n            \n        return score\n    \n    def calculate_quarterly_estimates(self, annual_income:\
    \ float, prior_year_tax: float, \n                                    current_withholding: float = 0) -> List[float]:\n\
    \        \"\"\"Calculate quarterly estimated tax payments\"\"\"\n        # Safe harbor rules: pay 100% of prior year tax\
    \ (110% if AGI > 150k)\n        safe_harbor = prior_year_tax * 1.1 if annual_income > 150000 else prior_year_tax\n   \
    \     \n        # Current year estimate\n        federal_tax = self.calculate_federal_tax(annual_income)\n        estimated_total\
    \ = federal_tax - current_withholding\n        \n        # Use higher of safe harbor or current year estimate\n      \
    \  required_payment = max(safe_harbor, estimated_total)\n        \n        if required_payment <= 0:\n            return\
    \ [0.0, 0.0, 0.0, 0.0]\n            \n        # Divide into quarterly payments\n        quarterly_amount = required_payment\
    \ / 4\n        \n        return [quarterly_amount] * 4\n    \n    def analyze_passive_activity(self, activities: List[Dict])\
    \ -> Dict[str, Any]:\n        \"\"\"Analyze passive activity rules and material participation\"\"\"\n        results =\
    \ []\n        \n        for activity in activities:\n            hours = activity.get(\"hours\", 0)\n            income\
    \ = activity.get(\"income\", 0)\n            activity_type = activity.get(\"type\", \"business\")\n            \n    \
    \        # Material participation tests (simplified)\n            material_participation = False\n            \n     \
    \       # Test 1: 500+ hours\n            if hours >= 500:\n                material_participation = True\n          \
    \      \n            # Test 2: Substantially all participation\n            elif hours >= 100 and activity.get(\"substantially_all\"\
    , False):\n                material_participation = True\n                \n            # Test 3: 100+ hours and more\
    \ than anyone else\n            elif hours >= 100 and activity.get(\"more_than_others\", False):\n                material_participation\
    \ = True\n                \n            # Real estate professional status\n            real_estate_professional = False\n\
    \            if activity_type == \"rental\" and hours >= 750 and activity.get(\"real_estate_business\", False):\n    \
    \            real_estate_professional = True\n                \n            classification = \"active\" if material_participation\
    \ else \"passive\"\n            \n            results.append({\n                \"activity\": activity.get(\"name\", \"\
    Unknown\"),\n                \"hours\": hours,\n                \"classification\": classification,\n                \"\
    material_participation\": material_participation,\n                \"real_estate_professional\": real_estate_professional,\n\
    \                \"loss_limitation\": 0 if classification == \"active\" else max(0, -income)\n            })\n       \
    \     \n        return {\n            \"activities\": results,\n            \"total_passive_loss\": sum(r[\"loss_limitation\"\
    ] for r in results),\n            \"grouping_recommendations\": self._suggest_grouping(results)\n        }\n    \n   \
    \ def _suggest_grouping(self, activities: List[Dict]) -> List[str]:\n        \"\"\"Suggest activity groupings under Section\
    \ 1.469-4\"\"\"\n        groupings = []\n        \n        # Similar businesses can be grouped\n        business_activities\
    \ = [a for a in activities if a[\"classification\"] == \"passive\"]\n        \n        if len(business_activities) >=\
    \ 2:\n            groupings.append(\"Consider grouping similar passive business activities\")\n            \n        #\
    \ Rental activities\n        rental_activities = [a for a in activities if \"rental\" in a[\"activity\"].lower()]\n  \
    \      if len(rental_activities) >= 2:\n            groupings.append(\"Consider grouping rental real estate activities\"\
    )\n            \n        return groupings\n    \n    def calculate_depreciation(self, asset_cost: float, asset_type: str,\
    \ \n                            placed_in_service: str, business_use: float = 1.0) -> Dict[str, Any]:\n        \"\"\"\
    Calculate depreciation using MACRS, Section 179, and bonus depreciation\"\"\"\n        placed_date = datetime.datetime.strptime(placed_in_service,\
    \ \"%Y-%m-%d\")\n        \n        # Asset class lives (simplified)\n        class_lives = {\n            \"equipment\"\
    : 5,\n            \"furniture\": 7,\n            \"building\": 39,\n            \"vehicle\": 5,\n            \"computer\"\
    : 5,\n            \"software\": 3\n        }\n        \n        recovery_period = class_lives.get(asset_type, 5)\n   \
    \     \n        # Section 179 limit for current year\n        section_179_limit = 1200000 if self.tax_year >= 2024 else\
    \ 1160000\n        \n        # Bonus depreciation percentage\n        bonus_percentage = 0.60 if self.tax_year >= 2024\
    \ else 0.80\n        \n        # Calculate options\n        section_179 = min(asset_cost * business_use, section_179_limit)\n\
    \        bonus_depreciation = (asset_cost - section_179) * business_use * bonus_percentage\n        remaining_basis =\
    \ asset_cost - section_179 - bonus_depreciation\n        \n        # MACRS depreciation on remaining basis\n        macrs_rate\
    \ = self._get_macrs_rate(recovery_period, 1)  # First year\n        macrs_depreciation = remaining_basis * macrs_rate\
    \ * business_use\n        \n        total_first_year = section_179 + bonus_depreciation + macrs_depreciation\n       \
    \ \n        return {\n            \"section_179\": section_179,\n            \"bonus_depreciation\": bonus_depreciation,\n\
    \            \"macrs_depreciation\": macrs_depreciation,\n            \"total_first_year\": total_first_year,\n      \
    \      \"remaining_basis\": asset_cost - total_first_year,\n            \"recovery_period\": recovery_period,\n      \
    \      \"recommendation\": self._depreciation_recommendation(asset_cost, section_179, bonus_depreciation)\n        }\n\
    \    \n    def _get_macrs_rate(self, recovery_period: int, year: int) -> float:\n        \"\"\"Get MACRS depreciation\
    \ rate (200% declining balance)\"\"\"\n        # Simplified MACRS rates\n        rates = {\n            3: [0.3333, 0.4445,\
    \ 0.1481, 0.0741],\n            5: [0.2000, 0.3200, 0.1920, 0.1152, 0.1152, 0.0576],\n            7: [0.1429, 0.2449,\
    \ 0.1749, 0.1249, 0.0893, 0.0892, 0.0893, 0.0446],\n            39: [0.0256] + [0.0256] * 38 + [0.0128]\n        }\n \
    \       \n        year_rates = rates.get(recovery_period, [0.1])\n        return year_rates[min(year - 1, len(year_rates)\
    \ - 1)]\n    \n    def _depreciation_recommendation(self, asset_cost: float, section_179: float, bonus: float) -> str:\n\
    \        \"\"\"Recommend optimal depreciation strategy\"\"\"\n        if asset_cost <= 250000:\n            return \"\
    Consider Section 179 for immediate deduction\"\n        elif bonus > 0:\n            return \"Bonus depreciation provides\
    \ significant first-year benefit\"\n        else:\n            return \"Regular MACRS depreciation may be optimal\"\n\
    \    \n    def generate_compliance_calendar(self, entities: List[TaxEntity]) -> List[Dict]:\n        \"\"\"Generate annual\
    \ compliance calendar with all filing deadlines\"\"\"\n        calendar = []\n        \n        for entity in entities:\n\
    \            if entity.entity_type == \"sole_proprietorship\":\n                # Schedule C with personal return\n  \
    \              calendar.append({\n                    \"entity\": entity.name,\n                    \"form\": \"Form 1040\
    \ + Schedule C\",\n                    \"due_date\": f\"{self.tax_year + 1}-04-15\",\n                    \"extension_available\"\
    : True,\n                    \"extension_due\": f\"{self.tax_year + 1}-10-15\"\n                })\n                \n\
    \            elif entity.entity_type == \"llc\":\n                # Single-member LLC - Schedule C\n                if\
    \ len(entity.income_sources) <= 1:\n                    calendar.append({\n                        \"entity\": entity.name,\n\
    \                        \"form\": \"Form 1040 + Schedule C\",\n                        \"due_date\": f\"{self.tax_year\
    \ + 1}-04-15\",\n                        \"extension_available\": True,\n                        \"extension_due\": f\"\
    {self.tax_year + 1}-10-15\"\n                    })\n                else:\n                    # Multi-member LLC - Partnership\
    \ return\n                    calendar.append({\n                        \"entity\": entity.name,\n                  \
    \      \"form\": \"Form 1065\",\n                        \"due_date\": f\"{self.tax_year + 1}-03-15\",\n             \
    \           \"extension_available\": True,\n                        \"extension_due\": f\"{self.tax_year + 1}-09-15\"\n\
    \                    })\n                    \n            elif entity.entity_type == \"s_corp\":\n                calendar.append({\n\
    \                    \"entity\": entity.name,\n                    \"form\": \"Form 1120-S\",\n                    \"\
    due_date\": f\"{self.tax_year + 1}-03-15\",\n                    \"extension_available\": True,\n                    \"\
    extension_due\": f\"{self.tax_year + 1}-09-15\"\n                })\n                \n            elif entity.entity_type\
    \ == \"c_corp\":\n                calendar.append({\n                    \"entity\": entity.name,\n                  \
    \  \"form\": \"Form 1120\",\n                    \"due_date\": f\"{self.tax_year + 1}-04-15\",\n                    \"\
    extension_available\": True,\n                    \"extension_due\": f\"{self.tax_year + 1}-10-15\"\n                })\n\
    \        \n        # Add quarterly estimates\n        for quarter in range(1, 5):\n            calendar.append({\n   \
    \             \"entity\": \"All entities\",\n                \"form\": f\"Quarterly Estimated Taxes Q{quarter}\",\n  \
    \              \"due_date\": f\"{self.tax_year + 1}-{['04-15', '06-15', '09-15', '01-15'][quarter - 1]}\",\n         \
    \       \"extension_available\": False,\n                \"extension_due\": None\n            })\n            \n     \
    \   return sorted(calendar, key=lambda x: x[\"due_date\"])\n    \n    def analyze_vine_tax_strategy(self, vine_income:\
    \ float, hours_monthly: float, \n                                 amazon_orders: float, donated_items: List[Dict]) ->\
    \ Dict[str, Any]:\n        \"\"\"Specialized analysis for Amazon Vine reviewers\"\"\"\n        # Determine passive vs\
    \ active classification\n        annual_hours = hours_monthly * 12\n        \n        # Material participation test\n\
    \        material_participation = annual_hours >= 500\n        \n        # Passive activity classification\n        activity_type\
    \ = \"active\" if material_participation else \"passive\"\n        \n        # Tax strategy for donated items\n      \
    \  donation_strategy = []\n        total_deduction = 0\n        \n        for item in donated_items:\n            fmv\
    \ = item.get(\"fair_market_value\", 0)\n            etv = item.get(\"estimated_tax_value\", 0)\n            \n       \
    \     # Donation deduction equals FMV at time of donation\n            deduction = fmv\n            total_deduction +=\
    \ deduction\n            \n            donation_strategy.append({\n                \"item\": item.get(\"description\"\
    , \"Unknown\"),\n                \"etv\": etv,\n                \"fmv\": fmv,\n                \"deduction\": deduction,\n\
    \                \"strategy\": \"Donate to rental business at FMV\"\n            })\n        \n        # Amazon orders\
    \ deduction\n        orders_deduction = amazon_orders * 0.8  # Assume 80% business use\n        \n        return {\n \
    \           \"activity_classification\": activity_type,\n            \"material_participation\": material_participation,\n\
    \            \"annual_hours\": annual_hours,\n            \"vine_income\": vine_income,\n            \"amazon_orders_deduction\"\
    : orders_deduction,\n            \"donation_strategy\": donation_strategy,\n            \"total_deductions\": total_deduction\
    \ + orders_deduction,\n            \"net_taxable_income\": max(0, vine_income - total_deduction - orders_deduction)\n\
    \        }\n    \n    def run(self, operation: str, **kwargs) -> Dict[str, Any]:\n        \"\"\"Main dispatch method for\
    \ all operations\"\"\"\n        operations = {\n            \"calculate_taxes\": self.calculate_federal_tax,\n       \
    \     \"optimize_structure\": self.optimize_business_structure,\n            \"quarterly_estimates\": self.calculate_quarterly_estimates,\n\
    \            \"passive_activity\": self.analyze_passive_activity,\n            \"depreciation\": self.calculate_depreciation,\n\
    \            \"compliance_calendar\": self.generate_compliance_calendar,\n            \"vine_strategy\": self.analyze_vine_tax_strategy,\n\
    \            \"state_tax\": self.calculate_state_tax,\n            \"self_employment_tax\": self.calculate_self_employment_tax\n\
    \        }\n        \n        if operation not in operations:\n            raise ValueError(f\"Unknown operation: {operation}\"\
    )\n            \n        try:\n            method = operations[operation]\n            return method(**kwargs)\n     \
    \   except Exception as e:\n            if self.debug:\n                raise\n            return {\"error\": str(e)}\n\
    \nclass TestTaxAutomation(unittest.TestCase):\n    \"\"\"Comprehensive test suite for tax automation engine\"\"\"\n  \
    \  \n    def setUp(self):\n        self.config = {\"tax_year\": 2024, \"debug\": True}\n        self.engine = TaxAutomationEngine(self.config)\n\
    \        \n    def test_metadata_validation(self):\n        \"\"\"Test skill metadata structure\"\"\"\n        self.assertEqual(SKILL_METADATA[\"\
    name\"], \"Expert Tax Automation & Multi-Business Strategist\")\n        self.assertEqual(SKILL_METADATA[\"id\"], \"tax_automation\"\
    )\n        self.assertGreater(len(SKILL_METADATA[\"capabilities\"]), 10)\n        \n    def test_federal_tax_calculation(self):\n\
    \        \"\"\"Test federal tax calculation\"\"\"\n        tax = self.engine.calculate_federal_tax(50000)\n        self.assertGreater(tax,\
    \ 0)\n        self.assertLess(tax, 50000)\n        \n    def test_state_tax_calculation(self):\n        \"\"\"Test state\
    \ tax calculation\"\"\"\n        ca_tax = self.engine.calculate_state_tax(50000, \"CA\")\n        ny_tax = self.engine.calculate_state_tax(50000,\
    \ \"NY\")\n        self.assertGreater(ca_tax, 0)\n        self.assertGreater(ny_tax, 0)\n        \n    def test_self_employment_tax(self):\n\
    \        \"\"\"Test self-employment tax calculation\"\"\"\n        se_tax = self.engine.calculate_self_employment_tax(50000)\n\
    \        self.assertGreater(se_tax, 0)\n        expected_range = 50000 * 0.15\n        self.assertAlmostEqual(se_tax,\
    \ expected_range, delta=1000)\n        \n    def test_business_structure_optimization(self):\n        \"\"\"Test business\
    \ structure optimization\"\"\"\n        result = self.engine.optimize_business_structure(\n            revenue=100000,\n\
    \            expenses=30000,\n            num_owners=1,\n            liability_concerns=True,\n            state=\"CA\"\
    \n        )\n        self.assertIn(\"recommendations\", result)\n        self.assertIn(\"optimal_structure\", result)\n\
    \        self.assertGreater(len(result[\"recommendations\"]), 0)\n        \n    def test_quarterly_estimates(self):\n\
    \        \"\"\"Test quarterly estimated tax calculation\"\"\"\n        estimates = self.engine.calculate_quarterly_estimates(\n\
    \            annual_income=75000,\n            prior_year_tax=12000,\n            current_withholding=5000\n        )\n\
    \        self.assertEqual(len(estimates), 4)\n        self.assertGreater(sum(estimates), 0)\n        \n    def test_passive_activity_analysis(self):\n\
    \        \"\"\"Test passive activity analysis\"\"\"\n        activities = [\n            {\"name\": \"Rental Property\"\
    , \"hours\": 50, \"income\": -5000, \"type\": \"rental\"},\n            {\"name\": \"Business Investment\", \"hours\"\
    : 100, \"income\": 10000, \"type\": \"business\"}\n        ]\n        result = self.engine.analyze_passive_activity(activities)\n\
    \        self.assertIn(\"activities\", result)\n        self.assertIn(\"total_passive_loss\", result)\n        \n    def\
    \ test_depreciation_calculation(self):\n        \"\"\"Test depreciation calculation\"\"\"\n        result = self.engine.calculate_depreciation(\n\
    \            asset_cost=50000,\n            asset_type=\"equipment\",\n            placed_in_service=\"2024-01-01\",\n\
    \            business_use=1.0\n        )\n        self.assertIn(\"section_179\", result)\n        self.assertIn(\"bonus_depreciation\"\
    , result)\n        self.assertIn(\"total_first_year\", result)\n        self.assertGreater(result[\"total_first_year\"\
    ], 0)\n        \n    def test_compliance_calendar(self):\n        \"\"\"Test compliance calendar generation\"\"\"\n  \
    \      entities = [\n            TaxEntity(\"Test Business\", \"sole_proprietorship\"),\n            TaxEntity(\"Test\
    \ LLC\", \"llc\")\n        ]\n        calendar = self.engine.generate_compliance_calendar(entities)\n        self.assertGreater(len(calendar),\
    \ 0)\n        self.assertIn(\"due_date\", calendar[0])\n        \n    def test_vine_strategy_analysis(self):\n       \
    \ \"\"\"Test Vine tax strategy analysis\"\"\"\n        donated_items = [\n            {\"description\": \"Electronics\"\
    , \"fair_market_value\": 500, \"estimated_tax_value\": 600},\n            {\"description\": \"Home Goods\", \"fair_market_value\"\
    : 300, \"estimated_tax_value\": 400}\n        ]\n        result = self.engine.analyze_vine_tax_strategy(\n           \
    \ vine_income=5000,\n            hours_monthly=4,\n            amazon_orders=2000,\n            donated_items=donated_items\n\
    \        )\n        self.assertIn(\"activity_classification\", result)\n        self.assertIn(\"net_taxable_income\",\
    \ result)\n        self.assertEqual(result[\"activity_classification\"], \"passive\")\n        \n    def test_run_method(self):\n\
    \        \"\"\"Test main run method dispatch\"\"\"\n        result = self.engine.run(\"calculate_taxes\", taxable_income=50000)\n\
    \        self.assertGreater(result, 0)\n        \n        result = self.engine.run(\"optimize_structure\", revenue=100000,\
    \ expenses=30000, \n                                 num_owners=1, liability_concerns=False, state=\"CA\")\n        self.assertIn(\"\
    optimal_structure\", result)\n        \n    def test_error_handling(self):\n        \"\"\"Test error handling in run method\"\
    \"\"\n        result = self.engine.run(\"invalid_operation\")\n        self.assertIn(\"error\", result)\n\nif __name__\
    \ == \"__main__\":\n    unittest.main()"
examples:
- description: Load and use the Expert Tax Automation & Multi-Business Strategist skill
  usage: 'from revvel_skills import load_skill

    skill = load_skill(''tax_automation'')

    result = skill.execute(params)'
schema_version: '1.0'
